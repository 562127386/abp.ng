!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@fs/permission-management"),require("@abp/ng.core"),require("@angular/core"),require("@fs/ng-alain/basic"),require("@abp/ng.permission-management"),require("@ngxs/store"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@fs/permission-management/ng-alain",["exports","@fs/permission-management","@abp/ng.core","@angular/core","@fs/ng-alain/basic","@abp/ng.permission-management","@ngxs/store","rxjs/operators"],n):n(((e=e||self).fs=e.fs||{},e.fs["permission-management"]=e.fs["permission-management"]||{},e.fs["permission-management"]["ng-alain"]={}),e.fs["permission-management"],e.ng_core,e.ng.core,e.basic,e.ng_permissionManagement,e.store,e.rxjs.operators)}(this,(function(e,n,t,r,i,o,a,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var l=function(e,n){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};var c=function(){return(c=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function p(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,i,o=t.call(e),a=[];try{for(;(void 0===n||n-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a}var m=function(e){function n(n,t){var r=e.call(this,n,t)||this;return r._store=n,r._renderer=t,r.selectAllIndeterminate=!1,r.selectAllThisTabIndeterminate=!1,r}return function(e,n){function t(){this.constructor=e}l(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}(n,e),Object.defineProperty(n.prototype,"visible",{get:function(){return this._visible},set:function(e){this.selectedGroup&&(this._visible=e,this.visibleChange.emit(e),e||(this.selectedGroup=null))},enumerable:!0,configurable:!0}),n.prototype.isGrantedByOtherProviderName=function(e){var n=this;return!!e.length&&e.findIndex((function(e){return e.providerName!==n.providerName}))>-1},n.prototype.onClickSelectAll=function(){var e=this;this.selectAllIndeterminate=!1,this.permissions=this.permissions.map((function(n){return c({},n,{isGranted:e.isGrantedByOtherProviderName(n.grantedProviders)||e.selectAllTab})})),this.selectThisTab=this.selectAllTab},n.prototype.onClickSelectThisTab=function(){var e=this;this.selectAllThisTabIndeterminate=!1,this.selectedGroupPermissions$.pipe(s.take(1)).subscribe((function(n){n.forEach((function(n){if(!n.isGranted||!e.isGrantedByOtherProviderName(n.grantedProviders)){var t=e.permissions.findIndex((function(e){return e.name===n.name}));e.permissions=function(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(p(arguments[n]));return e}(e.permissions.slice(0,t),[c({},e.permissions[t],{isGranted:e.selectThisTab})],e.permissions.slice(t+1))}}))})),this.setGrantCheckboxState()},n.prototype.onClickCheckbox=function(e){var n=this;e.isGranted&&this.isGrantedByOtherProviderName(e.grantedProviders)||setTimeout((function(){n.permissions=n.permissions.map((function(n){return e.name===n.name?c({},n,{isGranted:!n.isGranted}):e.name===n.parentName&&e.isGranted?c({},n,{isGranted:!1}):e.parentName!==n.name||e.isGranted?n:c({},n,{isGranted:!0})})),n.setTabCheckboxState(),n.setGrantCheckboxState()}),0)},n.prototype.setTabCheckboxState=function(){var e=this;this.selectedGroupPermissions$.pipe(s.take(1)).subscribe((function(n){var t=n.filter((function(e){return e.isGranted}));t.length===n.length?(e.selectAllThisTabIndeterminate=!1,e.selectThisTab=!0):0===t.length?(e.selectAllThisTabIndeterminate=!1,e.selectThisTab=!1):e.selectAllThisTabIndeterminate=!0}))},n.prototype.setGrantCheckboxState=function(){var e=this.permissions.filter((function(e){return e.isGranted}));e.length===this.permissions.length?(this.selectAllIndeterminate=!1,this.selectAllTab=!0):0===e.length?(this.selectAllIndeterminate=!1,this.selectAllTab=!1):this.selectAllIndeterminate=!0},n.decorators=[{type:r.Component,args:[{selector:"ng-alain-permission-management",template:'<ng-container *ngIf="{ entityName: entityName$ | async } as data">\r\n  <nz-modal [(nzVisible)]="visible"\r\n            (nzAfterOpen)="initModal()"\r\n            [nzTitle]="modalTitle"\r\n            [nzContent]="modalContent"\r\n            [nzFooter]="modalFooter"\r\n            (nzOnCancel)="visible=false"\r\n            nzWidth="1040"\r\n  >\r\n\r\n    <ng-template #modalTitle>\r\n      {{ \'AbpPermissionManagement::Permissions\' | abpLocalization }} - {{ data.entityName }}\r\n    </ng-template>\r\n\r\n    <ng-template #modalContent>\r\n      <nz-checkbox-wrapper >\r\n        <label nz-checkbox [(ngModel)]="selectAllTab" (ngModelChange)="onClickSelectAll()" [nzIndeterminate]="selectAllIndeterminate">\r\n          {{\'AbpPermissionManagement::SelectAllInAllTabs\' | abpLocalization}}\r\n        </label>\r\n      </nz-checkbox-wrapper>\r\n\r\n\r\n      <div class="main">\r\n        <div class="menu">\r\n          <ul nz-menu nzMode="inline">\r\n            <li *ngFor="let group of groups$ | async; trackBy: trackByFn" nz-menu-item [nzSelected]="selectedGroup?.name === group?.name" (click)="onChangeGroup(group)">{{ group?.displayName }}</li>\r\n          </ul>\r\n        </div>\r\n        <div class="content">\r\n          <div class="title">{{ selectedGroup?.displayName }}</div>\r\n          <nz-checkbox-wrapper>\r\n            <label nz-checkbox [(ngModel)]="selectThisTab" (ngModelChange)="onClickSelectThisTab()" [nzIndeterminate]="selectAllThisTabIndeterminate">\r\n              {{\'AbpPermissionManagement::SelectAllInThisTab\' | abpLocalization}}\r\n            </label>\r\n          </nz-checkbox-wrapper>\r\n          <div *ngFor="let permission of selectedGroupPermissions$ | async; let i = index; trackBy: trackByFn"\r\n               [style.margin-left]="permission.margin + \'px\'">\r\n            <nz-checkbox-wrapper>\r\n              <label nz-checkbox\r\n                     [ngModel]="getChecked(permission.name)"\r\n                     [nzDisabled]="isGrantedByOtherProviderName(permission.grantedProviders)"\r\n                     (ngModelChange)="onClickCheckbox(permission)"\r\n                     >\r\n                {{ permission.displayName }}\r\n                <span *ngFor="let provider of permission.grantedProviders">{{ provider.providerName }}: {{ provider.providerKey }}</span>\r\n              </label>\r\n            </nz-checkbox-wrapper>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </ng-template>\r\n\r\n    <ng-template #modalFooter>\r\n      <button nz-button nzType="default" (click)="visible=false">\r\n        {{ \'AbpIdentity::Cancel\' | abpLocalization }}\r\n      </button>\r\n      <button nz-button nzType="primary" (click)="submit()">\r\n        {{\r\n      \'AbpIdentity::Save\' | abpLocalization\r\n        }}\r\n      </button>\r\n    </ng-template>\r\n\r\n\r\n  </nz-modal>\r\n</ng-container>\r\n',styles:[":host{display:block;padding-top:24px}.main{display:-webkit-box;display:flex;width:100%;overflow:auto;background-color:#fff}.menu{width:224px;border-right:1px solid #e8e8e8}.menu ::ng-deep .ant-menu-inline{border:none}.menu ::ng-deep .ant-menu:not(.ant-menu-horizontal) .ant-menu-item-selected{font-weight:700}.content{-webkit-box-flex:1;flex:1;padding:8px 40px}.content .title{margin-bottom:12px;color:rgba(0,0,0,.85);font-weight:500;font-size:20px;line-height:28px}.content ::ng-deep .ant-list-split .ant-list-item:last-child{border-bottom:1px solid #e8e8e8}.content ::ng-deep .ant-list-item{padding-top:14px;padding-bottom:14px}@media screen and (max-width:767px){.main{-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.main .menu{width:100%;border:none}.main .content{padding:40px}}"]}]}],n.ctorParameters=function(){return[{type:a.Store},{type:r.Renderer2}]},n.propDecorators={providerName:[{type:r.Input}],providerKey:[{type:r.Input}],visible:[{type:r.Input}]},n}(o.PermissionManagementComponent);var d=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{declarations:[m],imports:[t.CoreModule,i.NgAlainBasicModule,n.PermissionManagementModule],exports:[m]}]}],e}();e.PermissionManagementNgAlainModule=d,e.Éµa=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=fs-permission-management-ng-alain.umd.min.js.map