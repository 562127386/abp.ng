{"version":3,"file":"fs-permission-management-ng-alain.js","sources":["ng://@fs/permission-management/ng-alain/lib/components/permission-management.component.ts","ng://@fs/permission-management/ng-alain/lib/permission-management-ng-alain.module.ts"],"sourcesContent":["import { PermissionManagementComponent as AbpPermissionManagementComponent, PermissionManagement } from '@abp/ng.permission-management';\r\nimport { Component, OnChanges, OnInit, Renderer2, Input } from '@angular/core';\r\nimport { Store } from '@ngxs/store';\r\nimport { take } from 'rxjs/operators';\r\n@Component({\r\n  selector: 'ng-alain-permission-management',\r\n  styleUrls: ['./permission-management.component.less'],\r\n  templateUrl: './permission-management.component.html'\r\n})\r\nexport class PermissionManagementComponent extends AbpPermissionManagementComponent\r\n  implements\r\n    PermissionManagement.PermissionManagementComponentInputs,\r\n    PermissionManagement.PermissionManagementComponentOutputs {\r\n  @Input()\r\n  providerName: string;\r\n\r\n  @Input()\r\n  providerKey: string;\r\n\r\n  @Input()\r\n  get visible(): boolean {\r\n    return this._visible;\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    if (!this.selectedGroup) return;\r\n\r\n    this._visible = value;\r\n    this.visibleChange.emit(value);\r\n\r\n    if (!value) {\r\n      this.selectedGroup = null;\r\n    }\r\n  }\r\n  \r\n  selectAllIndeterminate = false;\r\n  selectAllThisTabIndeterminate = false;\r\n  constructor(private _store: Store, private _renderer: Renderer2) {\r\n    super(_store, _renderer);\r\n  }\r\n  isGrantedByOtherProviderName(grantedProviders: PermissionManagement.GrantedProvider[]): boolean {\r\n    if (grantedProviders.length) {\r\n      return grantedProviders.findIndex(p => p.providerName !== this.providerName) > -1;\r\n    }\r\n    return false;\r\n  }\r\n  onClickSelectAll() {\r\n    this.selectAllIndeterminate = false;\r\n    this.permissions = this.permissions.map(permission => ({\r\n      ...permission,\r\n      isGranted: this.isGrantedByOtherProviderName(permission.grantedProviders) || this.selectAllTab,\r\n    }));\r\n\r\n    this.selectThisTab = this.selectAllTab;\r\n  }\r\n  onClickSelectThisTab() {\r\n    this.selectAllThisTabIndeterminate = false;\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      permissions.forEach(permission => {\r\n        if (permission.isGranted && this.isGrantedByOtherProviderName(permission.grantedProviders)) return;\r\n\r\n        const index = this.permissions.findIndex(per => per.name === permission.name);\r\n\r\n        this.permissions = [\r\n          ...this.permissions.slice(0, index),\r\n          { ...this.permissions[index], isGranted: this.selectThisTab },\r\n          ...this.permissions.slice(index + 1)\r\n        ];\r\n      });\r\n    });\r\n\r\n    this.setGrantCheckboxState();\r\n  }\r\n  onClickCheckbox(clickedPermission: PermissionManagement.Permission) {\r\n    if (clickedPermission.isGranted && this.isGrantedByOtherProviderName(clickedPermission.grantedProviders)) return;\r\n    setTimeout(() => {\r\n      this.permissions = this.permissions.map(per => {\r\n        if (clickedPermission.name === per.name) {\r\n          return { ...per, isGranted: !per.isGranted };\r\n        } else if (clickedPermission.name === per.parentName && clickedPermission.isGranted) {\r\n          return { ...per, isGranted: false };\r\n        } else if (clickedPermission.parentName === per.name && !clickedPermission.isGranted) {\r\n          return { ...per, isGranted: true };\r\n        }\r\n\r\n        return per;\r\n      });\r\n\r\n      this.setTabCheckboxState();\r\n      this.setGrantCheckboxState();\r\n    }, 0);\r\n  }\r\n  setTabCheckboxState() {\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      const selectedPermissions = permissions.filter(per => per.isGranted);\r\n      if (selectedPermissions.length === permissions.length) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = true;\r\n      } else if (selectedPermissions.length === 0) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = false;\r\n      } else {\r\n        this.selectAllThisTabIndeterminate = true;\r\n      }\r\n    });\r\n  }\r\n  setGrantCheckboxState() {\r\n    const selectedAllPermissions = this.permissions.filter(per => per.isGranted);\r\n\r\n    if (selectedAllPermissions.length === this.permissions.length) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = true;\r\n    } else if (selectedAllPermissions.length === 0) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = false;\r\n    } else {\r\n      this.selectAllIndeterminate = true;\r\n    }\r\n  }\r\n}\r\n\r\n","import { PermissionManagementModule } from '@fs/permission-management';\r\nimport { CoreModule } from '@abp/ng.core';\r\nimport { NgModule } from '@angular/core';\r\nimport { NgAlainBasicModule } from '@fs/ng-alain/basic';\r\nimport { PermissionManagementComponent } from './components/permission-management.component';\r\n\r\n@NgModule({\r\n    declarations: [PermissionManagementComponent],\r\n    imports: [\r\n        CoreModule,\r\n        NgAlainBasicModule,\r\n        PermissionManagementModule\r\n    ],\r\n    exports: [PermissionManagementComponent]\r\n})\r\nexport class PermissionManagementNgAlainModule { }\r\n"],"names":["tslib_1.__extends","AbpPermissionManagementComponent"],"mappings":"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"}