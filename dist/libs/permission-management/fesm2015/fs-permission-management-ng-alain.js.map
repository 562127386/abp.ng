{"version":3,"file":"fs-permission-management-ng-alain.js","sources":["ng://@fs/permission-management/ng-alain/lib/components/permission-management.component.ts","ng://@fs/permission-management/ng-alain/lib/permission-management-ng-alain.module.ts"],"sourcesContent":["import { PermissionManagementComponent as AbpPermissionManagementComponent, PermissionManagement } from '@abp/ng.permission-management';\r\nimport { Component, OnChanges, OnInit, Renderer2, Input } from '@angular/core';\r\nimport { Store } from '@ngxs/store';\r\nimport { take } from 'rxjs/operators';\r\n@Component({\r\n  selector: 'ng-alain-permission-management',\r\n  styleUrls: ['./permission-management.component.less'],\r\n  templateUrl: './permission-management.component.html'\r\n})\r\nexport class PermissionManagementComponent extends AbpPermissionManagementComponent implements OnInit, OnChanges {\r\n  @Input()\r\n  providerName: string;\r\n\r\n  @Input()\r\n  providerKey: string;\r\n\r\n  @Input()\r\n  get visible(): boolean {\r\n    return this._visible;\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    if (!this.selectedGroup) return;\r\n\r\n    this._visible = value;\r\n    this.visibleChange.emit(value);\r\n\r\n    if (!value) {\r\n      this.selectedGroup = null;\r\n    }\r\n  }\r\n  \r\n  selectAllIndeterminate = false;\r\n  selectAllThisTabIndeterminate = false;\r\n  constructor(private _store: Store, private _renderer: Renderer2) {\r\n    super(_store, _renderer);\r\n  }\r\n  isGrantedByOtherProviderName(grantedProviders: PermissionManagement.GrantedProvider[]): boolean {\r\n    if (grantedProviders.length) {\r\n      return grantedProviders.findIndex(p => p.providerName !== this.providerName) > -1;\r\n    }\r\n    return false;\r\n  }\r\n  onClickSelectAll() {\r\n    this.selectAllIndeterminate = false;\r\n    this.permissions = this.permissions.map(permission => ({\r\n      ...permission,\r\n      isGranted: this.isGrantedByOtherProviderName(permission.grantedProviders) || this.selectAllTab,\r\n    }));\r\n\r\n    this.selectThisTab = this.selectAllTab;\r\n  }\r\n  onClickSelectThisTab() {\r\n    this.selectAllThisTabIndeterminate = false;\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      permissions.forEach(permission => {\r\n        if (permission.isGranted && this.isGrantedByOtherProviderName(permission.grantedProviders)) return;\r\n\r\n        const index = this.permissions.findIndex(per => per.name === permission.name);\r\n\r\n        this.permissions = [\r\n          ...this.permissions.slice(0, index),\r\n          { ...this.permissions[index], isGranted: this.selectThisTab },\r\n          ...this.permissions.slice(index + 1)\r\n        ];\r\n      });\r\n    });\r\n\r\n    this.setGrantCheckboxState();\r\n  }\r\n  onClickCheckbox(clickedPermission: PermissionManagement.Permission) {\r\n    if (clickedPermission.isGranted && this.isGrantedByOtherProviderName(clickedPermission.grantedProviders)) return;\r\n    setTimeout(() => {\r\n      this.permissions = this.permissions.map(per => {\r\n        if (clickedPermission.name === per.name) {\r\n          return { ...per, isGranted: !per.isGranted };\r\n        } else if (clickedPermission.name === per.parentName && clickedPermission.isGranted) {\r\n          return { ...per, isGranted: false };\r\n        } else if (clickedPermission.parentName === per.name && !clickedPermission.isGranted) {\r\n          return { ...per, isGranted: true };\r\n        }\r\n\r\n        return per;\r\n      });\r\n\r\n      this.setTabCheckboxState();\r\n      this.setGrantCheckboxState();\r\n    }, 0);\r\n  }\r\n  setTabCheckboxState() {\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      const selectedPermissions = permissions.filter(per => per.isGranted);\r\n      if (selectedPermissions.length === permissions.length) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = true;\r\n      } else if (selectedPermissions.length === 0) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = false;\r\n      } else {\r\n        this.selectAllThisTabIndeterminate = true;\r\n      }\r\n    });\r\n  }\r\n  setGrantCheckboxState() {\r\n    const selectedAllPermissions = this.permissions.filter(per => per.isGranted);\r\n\r\n    if (selectedAllPermissions.length === this.permissions.length) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = true;\r\n    } else if (selectedAllPermissions.length === 0) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = false;\r\n    } else {\r\n      this.selectAllIndeterminate = true;\r\n    }\r\n  }\r\n}\r\n\r\n","import { PermissionManagementModule } from '@fs/permission-management';\r\nimport { CoreModule } from '@abp/ng.core';\r\nimport { NgModule } from '@angular/core';\r\nimport { NgAlainBasicModule } from '@fs/ng-alain/basic';\r\nimport { PermissionManagementComponent } from './components/permission-management.component';\r\n\r\n@NgModule({\r\n    declarations: [PermissionManagementComponent],\r\n    imports: [\r\n        CoreModule,\r\n        NgAlainBasicModule,\r\n        PermissionManagementModule\r\n    ],\r\n    exports: [PermissionManagementComponent]\r\n})\r\nexport class PermissionManagementNgAlainModule { }\r\n"],"names":["AbpPermissionManagementComponent"],"mappings":";;;;;;;;;;;;;AAAA,MASa,6BAA8B,SAAQA,+BAAgC;;;;;IAyBjF,YAAoB,MAAa,EAAU,SAAoB;QAC7D,KAAK,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;QADP,WAAM,GAAN,MAAM,CAAO;QAAU,cAAS,GAAT,SAAS,CAAW;QAF/D,2BAAsB,GAAG,KAAK,CAAC;QAC/B,kCAA6B,GAAG,KAAK,CAAC;KAGrC;;;;IApBD,IACI,OAAO;QACT,OAAO,IAAI,CAAC,QAAQ,CAAC;KACtB;;;;;IAED,IAAI,OAAO,CAAC,KAAc;QACxB,IAAI,CAAC,IAAI,CAAC,aAAa;YAAE,OAAO;QAEhC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAE/B,IAAI,CAAC,KAAK,EAAE;YACV,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;SAC3B;KACF;;;;;IAOD,4BAA4B,CAAC,gBAAwD;QACnF,IAAI,gBAAgB,CAAC,MAAM,EAAE;YAC3B,OAAO,gBAAgB,CAAC,SAAS;;;;YAAC,CAAC,IAAI,CAAC,CAAC,YAAY,KAAK,IAAI,CAAC,YAAY,EAAC,GAAG,CAAC,CAAC,CAAC;SACnF;QACD,OAAO,KAAK,CAAC;KACd;;;;IACD,gBAAgB;QACd,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;QACpC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG;;;;QAAC,UAAU,uBAC7C,UAAU,IACb,SAAS,EAAE,IAAI,CAAC,4BAA4B,CAAC,UAAU,CAAC,gBAAgB,CAAC,IAAI,IAAI,CAAC,YAAY,IAC9F,EAAC,CAAC;QAEJ,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,YAAY,CAAC;KACxC;;;;IACD,oBAAoB;QAClB,IAAI,CAAC,6BAA6B,GAAG,KAAK,CAAC;QAC3C,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS;;;;QAAC,WAAW;YAChE,WAAW,CAAC,OAAO;;;;YAAC,UAAU;gBAC5B,IAAI,UAAU,CAAC,SAAS,IAAI,IAAI,CAAC,4BAA4B,CAAC,UAAU,CAAC,gBAAgB,CAAC;oBAAE,OAAO;;sBAE7F,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS;;;;gBAAC,GAAG,IAAI,GAAG,CAAC,IAAI,KAAK,UAAU,CAAC,IAAI,EAAC;gBAE7E,IAAI,CAAC,WAAW,GAAG;oBACjB,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC;sCAC9B,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAE,SAAS,EAAE,IAAI,CAAC,aAAa;oBAC3D,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC;iBACrC,CAAC;aACH,EAAC,CAAC;SACJ,EAAC,CAAC;QAEH,IAAI,CAAC,qBAAqB,EAAE,CAAC;KAC9B;;;;;IACD,eAAe,CAAC,iBAAkD;QAChE,IAAI,iBAAiB,CAAC,SAAS,IAAI,IAAI,CAAC,4BAA4B,CAAC,iBAAiB,CAAC,gBAAgB,CAAC;YAAE,OAAO;QACjH,UAAU;;;QAAC;YACT,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG;;;;YAAC,GAAG;gBACzC,IAAI,iBAAiB,CAAC,IAAI,KAAK,GAAG,CAAC,IAAI,EAAE;oBACvC,yBAAY,GAAG,IAAE,SAAS,EAAE,CAAC,GAAG,CAAC,SAAS,IAAG;iBAC9C;qBAAM,IAAI,iBAAiB,CAAC,IAAI,KAAK,GAAG,CAAC,UAAU,IAAI,iBAAiB,CAAC,SAAS,EAAE;oBACnF,yBAAY,GAAG,IAAE,SAAS,EAAE,KAAK,IAAG;iBACrC;qBAAM,IAAI,iBAAiB,CAAC,UAAU,KAAK,GAAG,CAAC,IAAI,IAAI,CAAC,iBAAiB,CAAC,SAAS,EAAE;oBACpF,yBAAY,GAAG,IAAE,SAAS,EAAE,IAAI,IAAG;iBACpC;gBAED,OAAO,GAAG,CAAC;aACZ,EAAC,CAAC;YAEH,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC3B,IAAI,CAAC,qBAAqB,EAAE,CAAC;SAC9B,GAAE,CAAC,CAAC,CAAC;KACP;;;;IACD,mBAAmB;QACjB,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS;;;;QAAC,WAAW;;kBAC1D,mBAAmB,GAAG,WAAW,CAAC,MAAM;;;;YAAC,GAAG,IAAI,GAAG,CAAC,SAAS,EAAC;YACpE,IAAI,mBAAmB,CAAC,MAAM,KAAK,WAAW,CAAC,MAAM,EAAE;gBACrD,IAAI,CAAC,6BAA6B,GAAG,KAAK,CAAC;gBAC3C,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;aAC3B;iBAAM,IAAI,mBAAmB,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC3C,IAAI,CAAC,6BAA6B,GAAG,KAAK,CAAC;gBAC3C,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;aAC5B;iBAAM;gBACL,IAAI,CAAC,6BAA6B,GAAG,IAAI,CAAC;aAC3C;SACF,EAAC,CAAC;KACJ;;;;IACD,qBAAqB;;cACb,sBAAsB,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM;;;;QAAC,GAAG,IAAI,GAAG,CAAC,SAAS,EAAC;QAE5E,IAAI,sBAAsB,CAAC,MAAM,KAAK,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;YAC7D,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;YACpC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;SAC1B;aAAM,IAAI,sBAAsB,CAAC,MAAM,KAAK,CAAC,EAAE;YAC9C,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;YACpC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;SAC3B;aAAM;YACL,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC;SACpC;KACF;;;YA/GF,SAAS,SAAC;gBACT,QAAQ,EAAE,gCAAgC;gBAE1C,i5FAAqD;;aACtD;;;;YANQ,KAAK;YADyB,SAAS;;;2BAS7C,KAAK;0BAGL,KAAK;sBAGL,KAAK;;;;IANN,qDACqB;;IAErB,oDACoB;;IAkBpB,+DAA+B;;IAC/B,sEAAsC;;;;;IAC1B,+CAAqB;;;;;IAAE,kDAA4B;;;;;;;;AClCjE,MAea,iCAAiC;;;YAT7C,QAAQ,SAAC;gBACN,YAAY,EAAE,CAAC,6BAA6B,CAAC;gBAC7C,OAAO,EAAE;oBACL,UAAU;oBACV,kBAAkB;oBAClB,0BAA0B;iBAC7B;gBACD,OAAO,EAAE,CAAC,6BAA6B,CAAC;aAC3C;;;;;;;;;;;;;;;;;;;;;;;"}