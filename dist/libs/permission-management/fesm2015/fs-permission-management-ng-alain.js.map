{"version":3,"file":"fs-permission-management-ng-alain.js","sources":["../../../../libs/permission-management/ng-alain/src/lib/components/permission-management.component.html","../../../../libs/permission-management/ng-alain/src/lib/components/permission-management.component.ts","../../../../libs/permission-management/ng-alain/src/lib/permission-management-ng-alain.module.ts","../../../../libs/permission-management/ng-alain/src/fs-permission-management-ng-alain.ts"],"sourcesContent":["<ng-container *ngIf=\"{ entityName: entityName$ | async } as data\">\r\n  <nz-modal [(nzVisible)]=\"visible\"\r\n            (nzAfterOpen)=\"initModal()\"\r\n            [nzTitle]=\"modalTitle\"\r\n            [nzContent]=\"modalContent\"\r\n            [nzFooter]=\"modalFooter\"\r\n            (nzOnCancel)=\"visible=false\"\r\n            nzWidth=\"1040\"\r\n  >\r\n\r\n    <ng-template #modalTitle>\r\n      {{ 'AbpPermissionManagement::Permissions' | abpLocalization }} - {{ data.entityName }}\r\n    </ng-template>\r\n\r\n    <ng-template #modalContent>\r\n      <nz-checkbox-wrapper >\r\n        <label nz-checkbox [(ngModel)]=\"selectAllTab\" (ngModelChange)=\"onClickSelectAll()\" [nzIndeterminate]=\"selectAllIndeterminate\">\r\n          {{'AbpPermissionManagement::SelectAllInAllTabs' | abpLocalization}}\r\n        </label>\r\n      </nz-checkbox-wrapper>\r\n\r\n\r\n      <div class=\"main\">\r\n        <div class=\"menu\">\r\n          <ul nz-menu nzMode=\"inline\">\r\n            <li *ngFor=\"let group of groups$ | async; trackBy: trackByFn\" nz-menu-item [nzSelected]=\"selectedGroup?.name === group?.name\" (click)=\"onChangeGroup(group)\">{{ group?.displayName }}</li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"content\">\r\n          <div class=\"title\">{{ selectedGroup?.displayName }}</div>\r\n          <nz-checkbox-wrapper>\r\n            <label nz-checkbox [(ngModel)]=\"selectThisTab\" (ngModelChange)=\"onClickSelectThisTab()\" [nzIndeterminate]=\"selectAllThisTabIndeterminate\">\r\n              {{'AbpPermissionManagement::SelectAllInThisTab' | abpLocalization}}\r\n            </label>\r\n          </nz-checkbox-wrapper>\r\n          <div *ngFor=\"let permission of selectedGroupPermissions$ | async; let i = index; trackBy: trackByFn\"\r\n               [style.margin-left]=\"permission.margin + 'px'\">\r\n            <nz-checkbox-wrapper>\r\n              <label nz-checkbox\r\n                     [ngModel]=\"getChecked(permission.name)\"\r\n                     [nzDisabled]=\"isGrantedByOtherProviderName(permission.grantedProviders)\"\r\n                     (ngModelChange)=\"onClickCheckbox(permission)\"\r\n                     >\r\n                {{ permission.displayName }}\r\n                <span *ngFor=\"let provider of permission.grantedProviders\">{{ provider.providerName }}: {{ provider.providerKey }}</span>\r\n              </label>\r\n            </nz-checkbox-wrapper>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </ng-template>\r\n\r\n    <ng-template #modalFooter>\r\n      <button nz-button nzType=\"default\" (click)=\"visible=false\">\r\n        {{ 'AbpIdentity::Cancel' | abpLocalization }}\r\n      </button>\r\n      <button nz-button nzType=\"primary\" (click)=\"submit()\">\r\n        {{\r\n      'AbpIdentity::Save' | abpLocalization\r\n        }}\r\n      </button>\r\n    </ng-template>\r\n\r\n\r\n  </nz-modal>\r\n</ng-container>\r\n","import { PermissionManagementComponent as AbpPermissionManagementComponent, PermissionManagement } from '@abp/ng.permission-management';\r\nimport { Component, Renderer2, Input, Output, EventEmitter } from '@angular/core';\r\nimport { Store } from '@ngxs/store';\r\nimport { take } from 'rxjs/operators';\r\n@Component({\r\n  selector: 'ng-alain-permission-management',\r\n  styleUrls: ['./permission-management.component.less'],\r\n  templateUrl: './permission-management.component.html'\r\n})\r\nexport class PermissionManagementComponent extends AbpPermissionManagementComponent\r\n  implements\r\n  PermissionManagement.PermissionManagementComponentInputs,\r\n  PermissionManagement.PermissionManagementComponentOutputs {\r\n  @Input()\r\n  readonly providerName: string;\r\n\r\n  @Input()\r\n  readonly providerKey: string;\r\n\r\n  @Input()\r\n  readonly hideBadges = false;\r\n\r\n  protected _visible = false;\r\n\r\n  @Input()\r\n  get visible(): boolean {\r\n    return this._visible;\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    if (value === this._visible) return;\r\n\r\n    if (value) {\r\n      this.openModal().subscribe(() => {\r\n        this._visible = true;\r\n        this.visibleChange.emit(true);\r\n      });\r\n    } else {\r\n      this.selectedGroup = null;\r\n      this._visible = false;\r\n      this.visibleChange.emit(false);\r\n    }\r\n  }\r\n\r\n  @Output() readonly visibleChange = new EventEmitter<boolean>();\r\n\r\n  selectAllIndeterminate = false;\r\n  selectAllThisTabIndeterminate = false;\r\n  constructor(private _store: Store, private _renderer: Renderer2) {\r\n    super(_store, _renderer);\r\n\r\n    console.log('yc');\r\n  }\r\n  isGrantedByOtherProviderName(grantedProviders: PermissionManagement.GrantedProvider[]): boolean {\r\n    if (grantedProviders.length) {\r\n      return grantedProviders.findIndex(p => p.providerName !== this.providerName) > -1;\r\n    }\r\n    return false;\r\n  }\r\n  onClickSelectAll() {\r\n    this.selectAllIndeterminate = false;\r\n    this.permissions = this.permissions.map(permission => ({\r\n      ...permission,\r\n      isGranted: this.isGrantedByOtherProviderName(permission.grantedProviders) || this.selectAllTab,\r\n    }));\r\n\r\n    this.selectThisTab = this.selectAllTab;\r\n  }\r\n  onClickSelectThisTab() {\r\n    this.selectAllThisTabIndeterminate = false;\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      permissions.forEach(permission => {\r\n        if (permission.isGranted && this.isGrantedByOtherProviderName(permission.grantedProviders)) return;\r\n\r\n        const index = this.permissions.findIndex(per => per.name === permission.name);\r\n\r\n        this.permissions = [\r\n          ...this.permissions.slice(0, index),\r\n          { ...this.permissions[index], isGranted: this.selectThisTab },\r\n          ...this.permissions.slice(index + 1)\r\n        ];\r\n      });\r\n    });\r\n\r\n    this.setGrantCheckboxState();\r\n  }\r\n  onClickCheckbox(clickedPermission: PermissionManagement.Permission) {\r\n    if (clickedPermission.isGranted && this.isGrantedByOtherProviderName(clickedPermission.grantedProviders)) return;\r\n    setTimeout(() => {\r\n      this.permissions = this.permissions.map(per => {\r\n        if (clickedPermission.name === per.name) {\r\n          return { ...per, isGranted: !per.isGranted };\r\n        } else if (clickedPermission.name === per.parentName && clickedPermission.isGranted) {\r\n          return { ...per, isGranted: false };\r\n        } else if (clickedPermission.parentName === per.name && !clickedPermission.isGranted) {\r\n          return { ...per, isGranted: true };\r\n        }\r\n\r\n        return per;\r\n      });\r\n\r\n      this.setTabCheckboxState();\r\n      this.setGrantCheckboxState();\r\n    }, 0);\r\n  }\r\n  setTabCheckboxState() {\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      const selectedPermissions = permissions.filter(per => per.isGranted);\r\n      if (selectedPermissions.length === permissions.length) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = true;\r\n      } else if (selectedPermissions.length === 0) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = false;\r\n      } else {\r\n        this.selectAllThisTabIndeterminate = true;\r\n      }\r\n    });\r\n  }\r\n  setGrantCheckboxState() {\r\n    const selectedAllPermissions = this.permissions.filter(per => per.isGranted);\r\n\r\n    if (selectedAllPermissions.length === this.permissions.length) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = true;\r\n    } else if (selectedAllPermissions.length === 0) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = false;\r\n    } else {\r\n      this.selectAllIndeterminate = true;\r\n    }\r\n  }\r\n}\r\n\r\n","import { IdentityWrapModule } from '@fs/identity/wrap';\r\nimport { NgModule, ModuleWithProviders, NgModuleFactory } from '@angular/core';\r\nimport { NgAlainBasicModule } from '@fs/ng-alain/basic';\r\nimport { PermissionManagementComponent } from './components/permission-management.component';\r\n// import { RolesComponent } from './components/roles/roles.component';\r\nimport { LazyModuleFactory, CoreModule } from '@abp/ng.core';\r\nimport { PermissionManagementWrapModule } from '@fs/permission-management/wrap';\r\n//import { PermissionManagementNgAlainModule } from '@fs/permission-management/ng-alain';\r\n//import { SettingManagementNgAlainModule } from '@fs/setting-management/ng-alain';\r\n//import { InitialService} from './services/initial.service'\r\n\r\n@NgModule({\r\n  declarations: [PermissionManagementComponent],\r\n  entryComponents: [PermissionManagementComponent],\r\n  imports: [\r\n    CoreModule,\r\n    NgAlainBasicModule,\r\n    PermissionManagementWrapModule\r\n  ],\r\n  exports:[\r\n    PermissionManagementComponent\r\n  ]\r\n})\r\nexport class PermissionManagementNgAlainModule {\r\n  // static forChild(): ModuleWithProviders<PermissionManagementNgAlainModule> {\r\n  //   return {\r\n  //     ngModule: PermissionManagementNgAlainModule,\r\n  //     providers: [],\r\n  //   };\r\n  // }\r\n\r\n  // static forLazy(): NgModuleFactory<PermissionManagementNgAlainModule> {\r\n  //   return new LazyModuleFactory(PermissionManagementNgAlainModule.forChild());\r\n  // }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["i0.ɵɵtext","i0.ɵɵtextInterpolate2","i0.ɵɵelementStart","i0.ɵɵlistener","i0.ɵɵelementEnd","i0.ɵɵproperty","i0.ɵɵadvance","i0.ɵɵtextInterpolate","i0.ɵɵtemplate","i0.ɵɵstyleProp","i0.ɵɵtextInterpolate1","i0.ɵɵelementContainerStart","i0.ɵɵelementContainerEnd","AbpPermissionManagementComponent"],"mappings":"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"}